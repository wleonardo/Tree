"use strict";!function(e){if("function"==typeof define&&define.amd)define(["jquery"],e);else if("object"==typeof exports&&"object"==typeof module){var t="undefined"!=typeof window?window.$||window.jQuery:void 0;if(!t)try{t=require("jquery"),t.fn||(t.fn={})}catch(e){if(!t)throw new Error("jQuery dependency not found")}module.exports=e(t)}else e(jQuery)}(function(e,t){function o(t,n,r,d){t.forEach(function(t){t.text.indexOf(n)>=0?e.extend(t,r):e.extend(t,d),t.children&&t.children.length&&o(t.children,n,r,d)})}var n={ADD_CHILD_NODE:0,ADD_BROTHER_NODE:1},r=function(o,n){function r(e){if("object"!=typeof e)throw Error("node不是object")}function d(e){return!r(e)&&(e.children&&e.children.length)}function s(e){return!r(e)&&(e.open||e.searched)}function i(e){return e===t}function a(e){return e.open===!1}function h(o,n,r){var c=e('<ul data-sort="'+n+'""></ul>');return(!n&&r!==!1||r)&&c.addClass("show"),o.forEach(function(o,r){var l=e("<li><span><i></i>"+o.text+"</span></li>");if(o.searched&&l.addClass("searched"),l.attr("data-sort",n===t?r:n+"-"+r),(s(o)||i(n))&&l.addClass("open"),a(o)&&l.removeClass("open").addClass("closed"),d(o))var p=h(o.children,n===t?r:n+"-"+r,o.open);else l.addClass("no-children");l.append(p),c.append(l)}),c.find("li.open").parents("li").not(".closed").addClass("open").find(">ul").addClass("show"),c.find("li.searched").parents("li").addClass("open").find(">ul").addClass("show"),c}if(!o)return!1;var c={},l={};e.extend(l,c,n),this.nodes=l.nodes,this.getArrayDeep=function(e,t){if(!(t.length>1))return e[t[0]];var o=t.slice(1),n=this.getArrayDeep(e[t[0]].children,o);return n},this.updateTreeDom=function(){var t=h.call(this,this.nodes);e(o).empty().append(t)},this.selectNode=function(e){e=e.parent("li"),this.choosedNode=e,"function"==typeof this.chooseNodeCallBack&&this.chooseNodeCallBack(this.choosedNode)},e(o).delegate("li","click",function(o){var n=e(o.target);if("I"!==o.target.tagName.toUpperCase())return this.selectNode(n),!1;if(n=n.parents("li").first(),!n.length)return!1;var r=n.attr("data-sort");r=r.split("-");var d=this.getArrayDeep(this.nodes,r);d.open===t&&l.opened?d.open=!1:d.open=!d.open,this.updateTreeDom(),o.stopPropagation()}.bind(this)),this.updateTreeDom()};return r.prototype.search=function(e){e.length?o(this.nodes,e,{searched:!0},{searched:!1}):o(this.nodes,null,{searched:!0},{searched:!1}),this.updateTreeDom()},r.prototype.clickNode=function(e){this.chooseNodeCallBack=e},r.prototype.removeSelectNode=function(){if(!this.choosedNode||!this.choosedNode.length)return{errMes:"请先选择需要删除的节点"};var e=this.choosedNode.attr("data-sort").split("-"),t=this.getArrayDeep(this.nodes,e.slice(0,e.length-1));return t.children.splice(e[e.length-1],1),this.updateTreeDom(),{errMes:!1}},r.prototype.addNode=function(e){if(!this.choosedNode||!this.choosedNode.length)return console.error("请先选择一个节点"),{errMes:"请先选择一个节点"};if(!e.newNodeName||!e.newNodeName.length)return console.error("节点名字不可以为空"),{errMes:"节点名字不可以为空"};e.addNodeWay=parseInt(e.addNodeWay)||0;var t=this.choosedNode.attr("data-sort").split("-"),o={text:e.newNodeName};if(e.addNodeWay===n.ADD_CHILD_NODE){var r=this.getArrayDeep(this.nodes,t);r.open=!0,r.children=r.children||[],r.children.push(o)}else if(e.addNodeWay===n.ADD_BROTHER_NODE){var r=this.getArrayDeep(this.nodes,t.slice(0,t.length-1)),d=parseInt(t[t.length-1])+1;r.children.splice(d,0,o)}return this.updateTreeDom(),{errMes:!1}},window.Tree=r,r});